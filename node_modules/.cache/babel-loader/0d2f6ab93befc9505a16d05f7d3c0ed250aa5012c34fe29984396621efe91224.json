{"ast":null,"code":"import{useState,useEffect,useRef}from\"react\";import{MapContainer,TileLayer,Marker,Popup,Polyline}from\"react-leaflet\";import L from\"leaflet\";import\"leaflet/dist/leaflet.css\";// Fix cho marker icons\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:\"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",iconUrl:\"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",shadowUrl:\"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\"});export default function RealTimeMap(_ref){var _petData$,_petData$2,_petData$3;let{petData,selectedPet}=_ref;const[currentPosition,setCurrentPosition]=useState(null);const[path,setPath]=useState([]);const mapRef=useRef();// Cập nhật vị trí real-time\nuseEffect(()=>{if(petData&&petData.length>0&&petData[0].latitude&&petData[0].longitude){const latestData=petData[0];const newPosition=[latestData.latitude,latestData.longitude];setCurrentPosition(newPosition);setPath(prev=>[...prev.slice(-50),newPosition]);// Tự động pan map đến vị trí mới\nif(mapRef.current){mapRef.current.setView(newPosition,16);}}else{// Set default position if no data\nconst defaultPosition=[10.8231,106.6297];// HCM City\nsetCurrentPosition(defaultPosition);}},[petData]);if(!currentPosition){return/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\",height:\"400px\",backgroundColor:\"#f7fafc\",borderRadius:\"10px\"},children:/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:\"40px\",height:\"40px\",border:\"3px solid #e2e8f0\",borderTop:\"3px solid #4299e1\",borderRadius:\"50%\",animation:\"spin 1s linear infinite\",margin:\"0 auto 20px\"}}),/*#__PURE__*/_jsx(\"p\",{style:{color:\"#718096\"},children:\"\\u0110ang ch\\u1EDD d\\u1EEF li\\u1EC7u v\\u1ECB tr\\xED...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"map-container\",children:[/*#__PURE__*/_jsxs(MapContainer,{center:currentPosition,zoom:16,style:{height:\"100%\",width:\"100%\"},ref:mapRef,scrollWheelZoom:true,children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\"}),path.length>1&&/*#__PURE__*/_jsx(Polyline,{positions:path,color:\"#3B82F6\",weight:4,opacity:0.7}),currentPosition&&/*#__PURE__*/_jsx(Marker,{position:currentPosition,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:\"200px\"},children:[/*#__PURE__*/_jsx(\"strong\",{children:(selectedPet===null||selectedPet===void 0?void 0:selectedPet.name)||\"Pet\"}),/*#__PURE__*/_jsx(\"br\",{}),\"\\uD83D\\uDCCD \",currentPosition[0].toFixed(6),\",\",\" \",currentPosition[1].toFixed(6),/*#__PURE__*/_jsx(\"br\",{}),\"\\uD83C\\uDFC3 \",(petData===null||petData===void 0?void 0:(_petData$=petData[0])===null||_petData$===void 0?void 0:_petData$.activityType)||\"unknown\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u26A1 \",(petData===null||petData===void 0?void 0:(_petData$2=petData[0])===null||_petData$2===void 0?void 0:_petData$2.batteryLevel)||\"N/A\",\"%\",/*#__PURE__*/_jsx(\"br\",{}),\"\\uD83D\\uDD50\",\" \",petData!==null&&petData!==void 0&&(_petData$3=petData[0])!==null&&_petData$3!==void 0&&_petData$3.timestamp?new Date(petData[0].timestamp).toLocaleTimeString():\"N/A\"]})})})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:\"\\n        @keyframes spin {\\n          0% {\\n            transform: rotate(0deg);\\n          }\\n          100% {\\n            transform: rotate(360deg);\\n          }\\n        }\\n      \"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}